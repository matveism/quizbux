
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Work Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', Arial, sans-serif;
            background: linear-gradient(135deg, red 0%, darkorange 25%, darkred 60%, darkred 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 10px;
        }

        .container {
            width: 100%;
            max-width: 420px;
            background-color: #1a1a1a;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }

        /* Header */
        .header {
           background: linear-gradient(135deg, red 0%, darkorange 25%, darkred 60%, darkred 100%);
            padding: 12px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-title {
            color: white;
            font-size: 20px;
            font-weight: 500;
        }

        .header-icons {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .header-icon {
            width: 24px;
            height: 24px;
            background-color: rgba(255, 255, 255, 0.3);
            border-radius: 3px;
        }

        /* Login Form */
        .login-form {
            padding: 20px;
            background: linear-gradient(135deg, red 0%, darkorange 25%, darkred 60%, darkred 100%);
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-label {
            display: block;
            color: #2c3c4c;
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 5px;
        }

        .form-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #6c8ca8;
            border-radius: 4px;
            background-color: white;
            font-size: 16px;
            color: #1a1a1a;
        }

        .login-button {
            background: linear-gradient(135deg, red 0%, darkorange 25%, darkred 60%, darkred 100%);
            color: white;
            border: none;
            padding: 12px 15px;
            font-size: 18px;
            font-weight: 500;
            cursor: pointer;
            width: 100%;
            text-align: center;
            border-radius: 4px;
        }

        .login-button:active {
            background: linear-gradient(135deg, red 0%, darkorange 25%, darkred 60%, darkred 100%);
        }

        /* Dashboard */
        .dashboard {
            display: none;
            padding: 15px;
            background: linear-gradient(135deg, red 0%, darkorange 25%, darkred 60%, darkred 100%);
        }

        .user-info {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: #5a7a9a;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            font-weight: bold;
            margin-right: 15px;
        }

        .user-details {
            flex: 1;
        }

        .username {
            font-size: 18px;
            font-weight: 500;
            color: #2c3c4c;
        }

        .logout-btn {
            background: none;
            border: none;
            color: #2c3c4c;
            font-size: 14px;
            text-decoration: underline;
            cursor: pointer;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }

        .stat-card {
            background-color: rgba(255, 255, 255, 0.3);
            border-radius: 6px;
            padding: 12px;
            text-align: center;
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #2c3c4c;
        }

        .stat-label {
            font-size: 14px;
            color: #2c3c4c;
        }

        .level-section {
            margin-bottom: 20px;
        }

        .level-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }

        .level-label {
            font-size: 16px;
            font-weight: 500;
            color: #2c3c4c;
        }

        .level-value {
            font-size: 16px;
            font-weight: 500;
            color: #2c3c4c;
        }

        .progress-bar {
            height: 20px;
            background-color: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background-color: #4CAF50;
            border-radius: 10px;
            transition: width 0.3s;
        }

        .progress-fill.low {
            background-color: #f44336;
        }

        /* Work Form */
        .work-form {
            background-color: rgba(255, 255, 255, 0.3);
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .form-title {
            font-size: 18px;
            font-weight: 500;
            color: #2c3c4c;
            margin-bottom: 10px;
        }

        .work-input {
            width: 100%;
            padding: 10px;
            border: 2px solid #6c8ca8;
            border-radius: 4px;
            background-color: white;
            font-size: 16px;
            color: #1a1a1a;
            margin-bottom: 10px;
            resize: vertical;
            min-height: 80px;
        }

        .submit-btn {
            background: linear-gradient(135deg, red 0%, darkorange 25%, darkred 60%, darkred 100%);
            color: white;
            border: none;
            padding: 10px 15px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            width: 100%;
            text-align: center;
            border-radius: 4px;
        }

        .submit-btn:active {
            background: linear-gradient(135deg, pink 0%, darkorange 25%, purple 60%, #ff1a1a 100%);
        }

        .submit-btn:disabled {
            background: #cccccc;
            cursor: not-allowed;
        }

        /* Status Badges */
        .submission-status {
            margin-top: 15px;
        }

        .status-title {
            font-size: 16px;
            font-weight: 500;
            color: #2c3c4c;
            margin-bottom: 10px;
        }

        .status-badges {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .status-review {
            background-color: #f44336;
            color: white;
        }

        .status-approved {
            background-color: #4CAF50;
            color: white;
        }

        .badge-icon {
            font-size: 12px;
        }

        /* Bottom Navigation */
        .bottom-nav {
            display: flex;
            background: linear-gradient(135deg, pink 0%, darkorange 25%, purple 60%, #ff1a1a 100%);
            padding: 0;
        }

        .nav-item {
            flex: 1;
            text-align: center;
            padding: 12px 0;
            color: white;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            border-right: 1px solid rgba(255, 255, 255, 0.2);
        }

        .nav-item:last-child {
            border-right: none;
        }

        .nav-item.active {
            background-color: rgba(255, 255, 255, 0.2);
        }

        /* Content Sections */
        .content-section {
            display: none;
            padding: 15px;
            background: linear-gradient(135deg, pink 0%, darkorange 25%, purple 60%, #ff1a1a 100%);
            min-height: 400px;
        }

        .content-section.active {
            display: block;
        }

        /* Terms of Use Accordion */
        .accordion {
            margin-top: 15px;
        }

        .accordion-item {
            margin-bottom: 10px;
            border-radius: 6px;
            overflow: hidden;
            background-color: rgba(255, 255, 255, 0.2);
        }

        .accordion-header {
            padding: 12px 15px;
            background-color: rgba(255, 255, 255, 0.3);
            font-weight: 500;
            color: #2c3c4c;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .accordion-content {
            padding: 0 15px;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease, padding 0.3s ease;
            background-color: rgba(255, 255, 255, 0.1);
        }

        .accordion-item.active .accordion-content {
            padding: 15px;
            max-height: 500px;
        }

        .accordion-icon {
            transition: transform 0.3s ease;
        }

        .accordion-item.active .accordion-icon {
            transform: rotate(180deg);
        }

        .terms-text {
            color: #2c3c4c;
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 10px;
        }

        .highlight {
            color: #ff1a1a;
            font-weight: 500;
        }

        /* Cashout System */
        .cashout-form {
            background-color: rgba(255, 255, 255, 0.3);
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .reward-select {
            width: 100%;
            padding: 10px;
            border: 2px solid #6c8ca8;
            border-radius: 4px;
            background-color: white;
            font-size: 16px;
            color: #1a1a1a;
            margin-bottom: 10px;
        }

        .reward-details {
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            padding: 10px;
            margin-bottom: 10px;
            display: none;
        }

        .reward-detail {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            color: #2c3c4c;
        }

        .cashout-history {
            margin-top: 20px;
        }

        .cashout-item {
            background-color: rgba(255, 255, 255, 0.3);
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 10px;
        }

        .cashout-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .cashout-reward {
            font-weight: 500;
            color: #2c3c4c;
        }

        .cashout-status {
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .status-unsent {
            background-color: #ff9800;
            color: white;
        }

        .status-approved {
            background-color: #4CAF50;
            color: white;
        }

        .cashout-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 5px;
            margin-bottom: 8px;
        }

        .cashout-detail {
            font-size: 14px;
            color: #2c3c4c;
        }

        .cashout-notes {
            font-size: 14px;
            color: #2c3c4c;
            font-style: italic;
            padding-top: 8px;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: #1a1a1a;
            border-radius: 8px;
            overflow: hidden;
            width: 95%;
            max-width: 420px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }

        .modal-header {
            background: linear-gradient(135deg, pink 0%, darkorange 25%, purple 60%, #ff1a1a 100%);
            padding: 12px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            color: white;
            font-size: 20px;
            font-weight: 500;
        }

        .modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
        }

        .modal-body {
            padding: 20px;
            background: linear-gradient(to bottom, #8ca8c8, #7c98b8);
            min-height: 100px;
        }

        .modal-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0;
        }

        .modal-btn {
            background: linear-gradient(to bottom, #6a8aaa, #5a7a9a);
            color: white;
            font-size: 20px;
            font-weight: 500;
            padding: 15px;
            border: 1px solid #4a6a8a;
            cursor: pointer;
            text-align: center;
        }

        .modal-btn:active {
            background: linear-gradient(to bottom, #5a7a9a, #4a6a8a);
        }

        /* Loading spinner */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Eligibility indicators */
        .eligibility-status {
            margin-top: 10px;
            padding: 8px;
            border-radius: 4px;
            font-size: 14px;
            text-align: center;
            display: none;
        }

        .eligible {
            background-color: rgba(76, 175, 80, 0.3);
            color: #2c3c4c;
            border: 1px solid #4CAF50;
        }

        .not-eligible {
            background-color: rgba(244, 67, 54, 0.3);
            color: #2c3c4c;
            border: 1px solid #f44336;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-title">Work Dashboard</div>
            <div class="header-icons">
                <div class="header-icon"></div>
                <div class="header-icon"></div>
                <div class="header-icon"></div>
            </div>
        </div>

        <!-- Login Form (Initially Visible) -->
        <div class="login-form" id="loginForm">
            <div class="form-group">
                <label class="form-label" for="username">Username</label>
                <input type="text" class="form-input" id="username" placeholder="Enter your username">
            </div>
            <div class="form-group">
                <label class="form-label" for="password">Password</label>
                <input type="password" class="form-input" id="password" placeholder="Enter your password">
            </div>
            <button class="login-button" onclick="login()">Login</button>
        </div>

        <!-- Dashboard (Initially Hidden) -->
        <div class="dashboard" id="dashboard">
            <!-- User Info -->
            <div class="user-info">
                <div class="user-avatar" id="userAvatar">U</div>
                <div class="user-details">
                    <div class="username" id="displayUsername">Username</div>
                    <button class="logout-btn" onclick="logout()">Logout</button>
                </div>
            </div>

            <!-- Stats Grid -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="balanceValue">0.00</div>
                    <div class="stat-label">WorkRate</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="usdBalanceValue">$0.00</div>
                    <div class="stat-label">BalancePTS</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="workRateValue">0</div>
                    <div class="stat-label">Balance USD</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="levelValue">0</div>
                    <div class="stat-label">WorkRate</div>
                </div>
            </div>

            <!-- Bottom Navigation -->
            <div class="bottom-nav">
                <div class="nav-item active" data-target="work-section">Work</div>
                <div class="nav-item" data-target="cashout-section">Cashout</div>
                <div class="nav-item" data-target="terms-section">Terms</div>
            </div>

            <!-- Work Section -->
            <div class="content-section active" id="work-section">
                <!-- Level Progress -->
                <div class="level-section">
                    <div class="level-header">
                        <div class="level-label">Performance Level</div>
                        <div class="level-value" id="levelPercent">0%</div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="levelProgress" style="width: 0%"></div>
                    </div>
                </div>

                <!-- Work Submission Form -->
                <div class="work-form">
                    <div class="form-title">Submit Work</div>
                    <textarea class="work-input" id="workInput" placeholder="Enter your work submission here..."></textarea>
                    <button class="submit-btn" onclick="submitWork()">Submit Work</button>
                </div>

                <!-- Submission Status -->
                <div class="submission-status">
                    <div class="status-title">Submission Status</div>
                    <div class="status-badges" id="statusBadges">
                        <!-- Status badges will be added here dynamically -->
                    </div>
                </div>
            </div>

            <!-- Cashout Section -->
            <div class="content-section" id="cashout-section">
                <div class="cashout-form">
                    <div class="form-title">Request Cashout</div>
                    <select class="reward-select" id="rewardSelect" onchange="updateRewardDetails()">
                        <option value="">Select a reward</option>
                        <option value="amazon_1" data-workrate="1" data-amount="1">Amazon UK Voucher 1GBP</option>
                        <option value="amazon_5" data-workrate="500" data-amount="5">Amazon UK Voucher 5GBP</option>
                        <option value="amazon_10" data-workrate="1000" data-amount="10">Amazon UK Voucher 10GBP</option>
                        <option value="paypal_5" data-workrate="500" data-amount="5">PayPal Cash $5</option>
                        <option value="paypal_10" data-workrate="1000" data-amount="10">PayPal Cash $10</option>
                        <option value="paypal_20" data-workrate="2000" data-amount="20">PayPal Cash $20</option>
                    </select>
                    
                    <div class="reward-details" id="rewardDetails">
                        <div class="reward-detail">
                            <span>Work Rate Required:</span>
                            <span id="requiredWorkRate">0</span>
                        </div>
                        <div class="reward-detail">
                            <span>Amount:</span>
                            <span id="rewardAmount">$0.00</span>
                        </div>
                        <div class="reward-detail">
                            <span>Balance USD</span>
                            <span id="userWorkRate">0</span>
                        </div>
                        <div class="reward-detail">
                            <span>Your Balance PTS:</span>
                            <span id="userBalance">0.00</span>
                        </div>
                    </div>
                    
                    <div class="eligibility-status" id="eligibilityStatus"></div>
                    
                    <button class="submit-btn" onclick="submitCashout()" id="cashoutBtn" disabled>Request Cashout</button>
                </div>

                <div class="cashout-history">
                    <div class="status-title">Cashout History</div>
                    <div id="cashoutHistory">
                        <!-- Cashout history will be added here dynamically -->
                    </div>
                </div>
            </div>

            <!-- Terms Section -->
            <div class="content-section" id="terms-section">
                <div class="form-title">Terms of Use</div>
                
                <div class="accordion">
                    <div class="accordion-item">
                        <div class="accordion-header" onclick="toggleAccordion(this)">
                            Work Submission Process
                            <span class="accordion-icon">▼</span>
                        </div>
                        <div class="accordion-content">
                            <p class="terms-text">
                                Users submit their work via the provided form. Our admin team reviews all submitted work for compliance with our guidelines.
                            </p>
                            <p class="terms-text">
                                <span class="highlight">Important:</span> If your work is not approved within 24 hours of submission, this indicates that your submission was incorrect or did not meet our requirements. In such cases, you will not see any approval notification.
                            </p>
                        </div>
                    </div>
                    
                    <div class="accordion-item">
                        <div class="accordion-header" onclick="toggleAccordion(this)">
                            Prohibited Activities
                            <span class="accordion-icon">▼</span>
                        </div>
                        <div class="accordion-content">
                            <p class="terms-text">
                                Spamming the submission form is strictly prohibited. This includes but is not limited to:
                            </p>
                            <ul class="terms-text" style="padding-left: 20px;">
                                <li>Submitting duplicate or near-identical work</li>
                                <li>Submitting low-quality or irrelevant content</li>
                                <li>Attempting to game the system through automated submissions</li>
                                <li>Any other activity we determine to be spam</li>
                            </ul>
                            <p class="terms-text">
                                <span class="highlight">Consequences:</span> If we detect spamming activities, your account will be <span class="highlight">permanently deleted</span> and you will <span class="highlight">forfeit your entire balance</span>.
                            </p>
                        </div>
                    </div>
                    
                    <div class="accordion-item">
                        <div class="accordion-header" onclick="toggleAccordion(this)">
                            Reward System
                            <span class="accordion-icon">▼</span>
                        </div>
                        <div class="accordion-content">
                            <p class="terms-text">
                                Upon approval of your submitted work, you will receive 50 points, which is approximately equivalent to $0.03 USD.
                            </p>
                            <p class="terms-text">
                                The conversion rate between points and USD may vary based on current valuation. We reserve the right to adjust the point-to-USD conversion rate at our discretion.
                            </p>
                        </div>
                    </div>
                    
                    <div class="accordion-item">
                        <div class="accordion-header" onclick="toggleAccordion(this)">
                            Cashout Policy
                            <span class="accordion-icon">▼</span>
                        </div>
                        <div class="accordion-content">
                            <p class="terms-text">
                                Cashout requests are processed manually by our admin team. Processing times may vary.
                            </p>
                            <p class="terms-text">
                                Each reward has specific Work Rate requirements that must be met before you can request that reward.
                            </p>
                            <p class="terms-text">
                                Cashout requests will initially show as "Unsent" until approved by an admin. Once approved, the status will change to "Approved" and any admin notes will be visible.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Success Modal -->
    <div class="modal" id="successModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Success</div>
                <button class="modal-close" onclick="closeModal('successModal')">×</button>
            </div>
            <div class="modal-body">
                <p id="successMessage">Your work has been submitted successfully!</p>
            </div>
            <div class="modal-buttons">
                <button class="modal-btn" onclick="closeModal('successModal')">OK</button>
            </div>
        </div>
    </div>

    <!-- Error Modal -->
    <div class="modal" id="errorModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Error</div>
                <button class="modal-close" onclick="closeModal('errorModal')">×</button>
            </div>
            <div class="modal-body">
                <p id="errorMessage">Invalid username or password.</p>
            </div>
            <div class="modal-buttons">
                <button class="modal-btn" onclick="closeModal('errorModal')">OK</button>
            </div>
        </div>
    </div>

    <!-- Cashout Processing Modal -->
    <div class="modal" id="cashoutModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Processing Cashout</div>
                <button class="modal-close" onclick="closeModal('cashoutModal')">×</button>
            </div>
            <div class="modal-body">
                <p id="cashoutMessage">Submitting your cashout request...</p>
            </div>
            <div class="modal-buttons">
                <button class="modal-btn" onclick="closeModal('cashoutModal')">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        // Google Apps Script Web App URL
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwrJuI50NO7QyNr0Pc0HyGKQwHn0Bn8yuTAeIhu_pCf4AlIf_NbWmob4lCyGb8yPaeL/exec';

        // Current user data
        let currentUser = null;
        let userSubmissions = [];
        let userCashouts = [];

        // Update clock
        function updateClock() {
            const now = new Date();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const hours = String(now.getHours() % 12 || 12).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const ampm = now.getHours() >= 12 ? 'PM' : 'AM';
            document.getElementById('clock').textContent = `${month}/${day} ${hours}:${minutes} ${ampm}`;
        }

        // Login function
        async function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (!username || !password) {
                showError('Please enter both username and password.');
                return;
            }
            
            try {
                const formData = new FormData();
                formData.append('action', 'login');
                formData.append('username', username);
                formData.append('password', password);
                
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.status === 'success') {
                    currentUser = result.user;
                    userSubmissions = result.submissions || [];
                    userCashouts = result.cashouts || [];
                    showDashboard();
                } else {
                    showError(result.message || 'Invalid username or password.');
                }
            } catch (error) {
                console.error('Login error:', error);
                showError('Network error. Please try again.');
            }
        }

        // Logout function
        function logout() {
            currentUser = null;
            userSubmissions = [];
            userCashouts = [];
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            document.getElementById('loginForm').style.display = 'block';
            document.getElementById('dashboard').style.display = 'none';
        }

        // Show dashboard
        function showDashboard() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('dashboard').style.display = 'block';
            
            // Update user info
            document.getElementById('userAvatar').textContent = currentUser.username.charAt(0).toUpperCase();
            document.getElementById('displayUsername').textContent = currentUser.username;
            
            // Update stats
            document.getElementById('balanceValue').textContent = currentUser.balance;
            document.getElementById('usdBalanceValue').textContent = `$${parseFloat(currentUser.balanceUSD).toFixed(2)}`;
            document.getElementById('workRateValue').textContent = currentUser.workRate;
            document.getElementById('levelValue').textContent = currentUser.level;
            
            // Update level progress
            const levelPercent = parseInt(currentUser.level);
            document.getElementById('levelPercent').textContent = `${levelPercent}%`;
            const progressFill = document.getElementById('levelProgress');
            progressFill.style.width = `${levelPercent}%`;
            
            // Set progress bar color based on level
            if (levelPercent < 80) {
                progressFill.classList.add('low');
            } else {
                progressFill.classList.remove('low');
            }
            
            // Update submission status badges
            updateStatusBadges();
            
            // Update cashout history
            updateCashoutHistory();
        }

        // Submit work function
        async function submitWork() {
            const workInput = document.getElementById('workInput').value.trim();
            
            if (!workInput) {
                showError('Please enter your work submission.');
                return;
            }
            
            try {
                const formData = new FormData();
                formData.append('action', 'submitWork');
                formData.append('username', currentUser.username);
                formData.append('submission', workInput);
                
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.status === 'success') {
                    // Add the new submission to the list
                    userSubmissions.unshift({
                        id: Date.now(),
                        submission: workInput,
                        status: 'REVIEW',
                        timestamp: new Date().toISOString()
                    });
                    
                    // Clear input
                    document.getElementById('workInput').value = '';
                    
                    // Update status badges
                    updateStatusBadges();
                    
                    // Show success message
                    document.getElementById('successMessage').textContent = 'Your work has been submitted successfully!';
                    document.getElementById('successModal').classList.add('active');
                } else {
                    showError(result.message || 'Failed to submit work.');
                }
            } catch (error) {
                console.error('Submit work error:', error);
                showError('Network error. Please try again.');
            }
        }

        // Update status badges
        function updateStatusBadges() {
            const statusBadges = document.getElementById('statusBadges');
            statusBadges.innerHTML = '';
            
            // Show only the 5 most recent submissions
            const recentSubmissions = userSubmissions.slice(0, 5);
            
            recentSubmissions.forEach(submission => {
                const badge = document.createElement('div');
                badge.className = `status-badge ${submission.status === 'REVIEW' ? 'status-review' : 'status-approved'}`;
                
                const icon = document.createElement('span');
                icon.className = 'badge-icon';
                icon.textContent = submission.status === 'REVIEW' ? '⏳' : '✅';
                
                const text = document.createElement('span');
                text.textContent = submission.status === 'REVIEW' ? 'REVIEW' : 'APPROVED';
                
                badge.appendChild(icon);
                badge.appendChild(text);
                statusBadges.appendChild(badge);
            });
            
            // If no submissions, show message
            if (userSubmissions.length === 0) {
                statusBadges.innerHTML = '<div style="color: #2c3c4c; font-style: italic;">No submissions yet</div>';
            }
        }

        // Toggle accordion sections
        function toggleAccordion(element) {
            const item = element.parentElement;
            item.classList.toggle('active');
        }

        // Navigation between sections
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', function() {
                // Remove active class from all nav items and content sections
                document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
                document.querySelectorAll('.content-section').forEach(section => section.classList.remove('active'));
                
                // Add active class to clicked nav item and corresponding section
                this.classList.add('active');
                const targetId = this.getAttribute('data-target');
                document.getElementById(targetId).classList.add('active');
            });
        });

        // Update reward details when selection changes
        function updateRewardDetails() {
            const select = document.getElementById('rewardSelect');
            const details = document.getElementById('rewardDetails');
            const cashoutBtn = document.getElementById('cashoutBtn');
            const eligibilityStatus = document.getElementById('eligibilityStatus');
            
            if (select.value) {
                const selectedOption = select.options[select.selectedIndex];
                const workRateRequired = selectedOption.getAttribute('data-workrate');
                const amount = selectedOption.getAttribute('data-amount');
                
                document.getElementById('requiredWorkRate').textContent = workRateRequired;
                document.getElementById('rewardAmount').textContent = `$${amount}`;
                document.getElementById('userWorkRate').textContent = currentUser.workRate;
                document.getElementById('userBalance').textContent = `$${parseFloat(currentUser.balanceUSD).toFixed(2)}`;
                
                details.style.display = 'block';
                
                // Check eligibility
                const workRateEligible = parseInt(currentUser.workRate) >= parseInt(workRateRequired);
                const balanceEligible = parseFloat(currentUser.balanceUSD) >= parseFloat(amount);
                const isEligible = workRateEligible && balanceEligible;
                
                // Update eligibility status
                if (isEligible) {
                    eligibilityStatus.textContent = "✓ You are eligible for this reward!";
                    eligibilityStatus.className = "eligibility-status eligible";
                    eligibilityStatus.style.display = "block";
                } else {
                    let message = "You are not eligible for this reward. ";
                    if (!workRateEligible && !balanceEligible) {
                        message += `You need ${workRateRequired} Work Rate (you have ${currentUser.workRate}) and $${amount} USD balance (you have $${parseFloat(currentUser.balanceUSD).toFixed(2)}).`;
                    } else if (!workRateEligible) {
                        message += `You need ${workRateRequired} Work Rate (you have ${currentUser.workRate}).`;
                    } else {
                        message += `You need $${amount} USD balance (you have $${parseFloat(currentUser.balanceUSD).toFixed(2)}).`;
                    }
                    eligibilityStatus.textContent = message;
                    eligibilityStatus.className = "eligibility-status not-eligible";
                    eligibilityStatus.style.display = "block";
                }
                
                // Enable/disable cashout button based on requirements
                cashoutBtn.disabled = !isEligible;
            } else {
                details.style.display = 'none';
                eligibilityStatus.style.display = 'none';
                cashoutBtn.disabled = true;
            }
        }

        // Submit cashout request
        async function submitCashout() {
            const select = document.getElementById('rewardSelect');
            const selectedOption = select.options[select.selectedIndex];
            const rewardName = selectedOption.text;
            const workRateRequired = selectedOption.getAttribute('data-workrate');
            const amount = selectedOption.getAttribute('data-amount');
            
            // Show processing modal
            document.getElementById('cashoutMessage').textContent = 'Submitting your cashout request...';
            document.getElementById('cashoutModal').classList.add('active');
            
            try {
                const formData = new FormData();
                formData.append('action', 'submitCashout');
                formData.append('username', currentUser.username);
                formData.append('reward', rewardName);
                formData.append('workRateRequired', workRateRequired);
                formData.append('amount', amount);
                formData.append('timestamp', new Date().toISOString());
                
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                // Close processing modal
                document.getElementById('cashoutModal').classList.remove('active');
                
                if (result.status === 'success') {
                    // Add the new cashout to the list
                    userCashouts.unshift({
                        id: Date.now(),
                        reward: rewardName,
                        workRateRequired: workRateRequired,
                        amount: amount,
                        status: 'UNSENT',
                        timestamp: new Date().toISOString(),
                        notes: ''
                    });
                    
                    // Reset form
                    select.value = '';
                    document.getElementById('rewardDetails').style.display = 'none';
                    document.getElementById('eligibilityStatus').style.display = 'none';
                    document.getElementById('cashoutBtn').disabled = true;
                    
                    // Update cashout history
                    updateCashoutHistory();
                    
                    // Show success message
                    document.getElementById('successMessage').textContent = 'Your cashout request has been submitted successfully!';
                    document.getElementById('successModal').classList.add('active');
                } else {
                    showError(result.message || 'Failed to submit cashout request.');
                }
            } catch (error) {
                console.error('Submit cashout error:', error);
                // Close processing modal
                document.getElementById('cashoutModal').classList.remove('active');
                showError('Network error. Please try again.');
            }
        }

        // Update cashout history display
        function updateCashoutHistory() {
            const cashoutHistory = document.getElementById('cashoutHistory');
            cashoutHistory.innerHTML = '';
            
            if (userCashouts.length === 0) {
                cashoutHistory.innerHTML = '<div style="color: #2c3c4c; font-style: italic; text-align: center;">No cashout requests yet</div>';
                return;
            }
            
            userCashouts.forEach(cashout => {
                const item = document.createElement('div');
                item.className = 'cashout-item';
                
                const header = document.createElement('div');
                header.className = 'cashout-header';
                
                const reward = document.createElement('div');
                reward.className = 'cashout-reward';
                reward.textContent = cashout.reward;
                
                const status = document.createElement('div');
                status.className = `cashout-status ${cashout.status === 'UNSENT' ? 'status-unsent' : 'status-approved'}`;
                status.textContent = cashout.status;
                
                header.appendChild(reward);
                header.appendChild(status);
                
                const details = document.createElement('div');
                details.className = 'cashout-details';
                
                const amount = document.createElement('div');
                amount.className = 'cashout-detail';
                amount.textContent = `Amount: $${cashout.amount}`;
                
                const workRate = document.createElement('div');
                workRate.className = 'cashout-detail';
                workRate.textContent = `Work Rate: ${cashout.workRateRequired}`;
                
                const date = document.createElement('div');
                date.className = 'cashout-detail';
                date.textContent = `Date: ${new Date(cashout.timestamp).toLocaleDateString()}`;
                
                const statusDetail = document.createElement('div');
                statusDetail.className = 'cashout-detail';
                statusDetail.textContent = `Status: ${cashout.status}`;
                
                details.appendChild(amount);
                details.appendChild(workRate);
                details.appendChild(date);
                details.appendChild(statusDetail);
                
                item.appendChild(header);
                item.appendChild(details);
                
                // Add notes if available
                if (cashout.notes) {
                    const notes = document.createElement('div');
                    notes.className = 'cashout-notes';
                    notes.textContent = `Admin Notes: ${cashout.notes}`;
                    item.appendChild(notes);
                }
                
                cashoutHistory.appendChild(item);
            });
        }

        // Show error modal
        function showError(message) {
            document.getElementById('errorMessage').textContent = message;
            document.getElementById('errorModal').classList.add('active');
        }

        // Close modal
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        // Initialize
        updateClock();
        setInterval(updateClock, 1000);
    </script>
</body>
</html>
