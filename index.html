<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Work Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', Arial, sans-serif;
            background: linear-gradient(260deg, darkblue 0%, purple 25%, brown 50%, darkblue 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 10px;
        }

        .container {
            width: 100%;
            max-width: 420px;
            background-color: #1a1a1a;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }

        /* Header */
        .header {
           background: linear-gradient(260deg, darkblue 0%, purple 25%, brown 50%, darkblue 100%);
            padding: 12px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-title {
            color: white;
            font-size: 20px;
            font-weight: 500;
        }

        .header-icons {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .header-icon {
            width: 24px;
            height: 24px;
            background-color: rgba(255, 255, 255, 0.3);
            border-radius: 3px;
        }

        /* Login Form */
        .login-form {
            padding: 20px;
            background: linear-gradient(260deg, darkblue 0%, purple 25%, brown 50%, darkblue 100%);
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-label {
            display: block;
            color: white;
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 5px;
        }

        .form-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #6c8ca8;
            border-radius: 4px;
            background-color: white;
            font-size: 16px;
            color: #1a1a1a;
        }

        .login-button {
            background: linear-gradient(260deg, darkblue 0%, purple 25%, brown 50%, darkblue 100%);
            color: white;
            border: none;
            padding: 12px 15px;
            font-size: 18px;
            font-weight: 500;
            cursor: pointer;
            width: 100%;
            text-align: center;
            border-radius: 4px;
        }

        .login-button:active {
            background: linear-gradient(260deg, darkblue 0%, purple 25%, brown 50%, darkblue 100%);
        }

        /* Dashboard */
        .dashboard {
            display: none;
            padding: 15px;
            background: linear-gradient(260deg, darkblue 0%, purple 25%, brown 50%, darkblue 100%);
        }

        .user-info {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: #5a7a9a;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            font-weight: bold;
            margin-right: 15px;
        }

        .user-details {
            flex: 1;
        }

        .username {
            font-size: 18px;
            font-weight: 500;
            color: white;
        }

        .logout-btn {
            background: none;
            border: none;
            color: white;
            font-size: 14px;
            text-decoration: underline;
            cursor: pointer;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }

        .stat-card {
            background-color: rgba(255, 255, 255, 0.3);
            border-radius: 6px;
            padding: 12px;
            text-align: center;
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: white;
        }

        .stat-label {
            font-size: 14px;
            color: white;
        }

        .level-section {
            margin-bottom: 20px;
        }

        .level-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }

        .level-label {
            font-size: 16px;
            font-weight: 500;
            color: white;
        }

        .level-value {
            font-size: 16px;
            font-weight: 500;
            color: white;
        }

        .progress-bar {
            height: 20px;
            background-color: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background-color: #4CAF50;
            border-radius: 10px;
            transition: width 0.3s;
        }

        .progress-fill.low {
            background-color: #f44336;
        }

        .progress-fill.medium {
            background-color: #ffa502;
        }

        .progress-fill.high {
            background-color: #2ed573;
        }

        /* Work Form */
        .work-form {
            background-color: rgba(255, 255, 255, 0.3);
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .form-title {
            font-size: 18px;
            font-weight: 500;
            color: white;
            margin-bottom: 10px;
        }

        .work-input {
            width: 100%;
            padding: 10px;
            border: 2px solid #6c8ca8;
            border-radius: 4px;
            background-color: white;
            font-size: 16px;
            color: #1a1a1a;
            margin-bottom: 10px;
            resize: vertical;
            min-height: 80px;
        }

        .submit-btn {
            background: linear-gradient(135deg, red 0%, darkorange 25%, darkred 60%, darkred 100%);
            color: white;
            border: none;
            padding: 10px 15px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            width: 100%;
            text-align: center;
            border-radius: 4px;
        }

        .submit-btn:active {
            background: linear-gradient(135deg, pink 0%, darkorange 25%, purple 60%, #ff1a1a 100%);
        }

        .submit-btn:disabled {
            background: #cccccc;
            cursor: not-allowed;
        }

        /* Status Badges */
        .submission-status {
            margin-top: 15px;
        }

        .status-title {
            font-size: 16px;
            font-weight: 500;
            color: white;
            margin-bottom: 10px;
        }

        .status-badges {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .status-review {
            background-color: #f44336;
            color: white;
        }

        .status-approved {
            background-color: #4CAF50;
            color: white;
        }

        .badge-icon {
            font-size: 12px;
        }

        /* Bottom Navigation */
        .bottom-nav {
            display: flex;
            background: linear-gradient(135deg, pink 0%, darkorange 25%, purple 60%, #ff1a1a 100%);
            padding: 0;
        }

        .nav-item {
            flex: 1;
            text-align: center;
            padding: 12px 0;
            color: white;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            border-right: 1px solid rgba(255, 255, 255, 0.2);
        }

        .nav-item:last-child {
            border-right: none;
        }

        .nav-item.active {
            background-color: rgba(255, 255, 255, 0.2);
        }

        /* Content Sections */
        .content-section {
            display: none;
            padding: 15px;
            background: linear-gradient(135deg, pink 0%, darkorange 25%, purple 60%, #ff1a1a 100%);
            min-height: 400px;
        }

        .content-section.active {
            display: block;
        }

        /* Terms of Use Accordion */
        .accordion {
            margin-top: 15px;
        }

        .accordion-item {
            margin-bottom: 10px;
            border-radius: 6px;
            overflow: hidden;
            background-color: rgba(255, 255, 255, 0.2);
        }

        .accordion-header {
            padding: 12px 15px;
            background-color: rgba(255, 255, 255, 0.3);
            font-weight: 500;
            color: white;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .accordion-content {
            padding: 0 15px;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease, padding 0.3s ease;
            background-color: rgba(255, 255, 255, 0.1);
        }

        .accordion-item.active .accordion-content {
            padding: 15px;
            max-height: 500px;
        }

        .accordion-icon {
            transition: transform 0.3s ease;
        }

        .accordion-item.active .accordion-icon {
            transform: rotate(180deg);
        }

        .terms-text {
            color: white;
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 10px;
        }

        .highlight {
            color: #ff1a1a;
            font-weight: 500;
        }

        /* Cashout System */
        .cashout-form {
            background-color: rgba(255, 255, 255, 0.3);
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .reward-select {
            width: 100%;
            padding: 10px;
            border: 2px solid #6c8ca8;
            border-radius: 4px;
            background-color: white;
            font-size: 16px;
            color: #1a1a1a;
            margin-bottom: 10px;
        }

        .reward-details {
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            padding: 10px;
            margin-bottom: 10px;
            display: none;
        }

        .reward-detail {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            color: white;
        }

        .cashout-history {
            margin-top: 20px;
        }

        .cashout-item {
            background-color: rgba(255, 255, 255, 0.3);
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 10px;
        }

        .cashout-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .cashout-reward {
            font-weight: 500;
            color: white;
        }

        .cashout-status {
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .status-unsent {
            background-color: #ff9800;
            color: white;
        }

        .status-pending {
            background-color: #ffa502;
            color: white;
        }

        .status-approved {
            background-color: #4CAF50;
            color: white;
        }

        .status-rejected {
            background-color: #ff4757;
            color: white;
        }

        .cashout-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 5px;
            margin-bottom: 8px;
        }

        .cashout-detail {
            font-size: 14px;
            color: white;
        }

        .cashout-notes {
            font-size: 14px;
            color: white;
            font-style: italic;
            padding-top: 8px;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: #1a1a1a;
            border-radius: 8px;
            overflow: hidden;
            width: 95%;
            max-width: 420px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }

        .modal-header {
            background: linear-gradient(135deg, pink 0%, darkorange 25%, purple 60%, #ff1a1a 100%);
            padding: 12px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            color: white;
            font-size: 20px;
            font-weight: 500;
        }

        .modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
        }

        .modal-body {
            padding: 20px;
            background: linear-gradient(to bottom, #8ca8c8, #7c98b8);
            min-height: 100px;
        }

        .modal-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0;
        }

        .modal-btn {
            background: linear-gradient(to bottom, #6a8aaa, #5a7a9a);
            color: white;
            font-size: 20px;
            font-weight: 500;
            padding: 15px;
            border: 1px solid #4a6a8a;
            cursor: pointer;
            text-align: center;
        }

        .modal-btn:active {
            background: linear-gradient(to bottom, #5a7a9a, #4a6a8a);
        }

        /* Loading spinner */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Eligibility indicators */
        .eligibility-status {
            margin-top: 10px;
            padding: 8px;
            border-radius: 4px;
            font-size: 14px;
            text-align: center;
            display: none;
        }

        .eligible {
            background-color: rgba(76, 175, 80, 0.3);
            color: white;
            border: 1px solid #4CAF50;
        }

        .not-eligible {
            background-color: rgba(244, 67, 54, 0.3);
            color: white;
            border: 1px solid #f44336;
        }

        /* Logo */
        .quizbux-logo {
            max-width: 100%;
            height: auto;
        }

        .logo-container {
            text-align: center;
            padding: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-title">
                <div class="logo-container">
                    <img src="https://i.postimg.cc/FK5qWX8z/Gemini-Generated-Image-3osxq23osxq23osx-removebg-preview.png" width="250px" height="100px" alt="QuizBux Logo" class="quizbux-logo">
                </div>
            </div>
            <div class="header-icons">
                <div class="header-icon"></div>
                <div class="header-icon"></div>
                <div class="header-icon"></div>
            </div>
        </div>

        <!-- Login Form (Initially Visible) -->
        <div class="login-form" id="loginForm">
            <div class="form-group">
                <label class="form-label" for="username">Username</label>
                <input type="text" class="form-input" id="username" placeholder="Enter your username">
            </div>
            <div class="form-group">
                <label class="form-label" for="password">Password</label>
                <input type="password" class="form-input" id="password" placeholder="Enter your password">
            </div>
            <button class="login-button" onclick="login()">Login</button>
        </div>

        <!-- Dashboard (Initially Hidden) -->
        <div class="dashboard" id="dashboard">
            <!-- User Info -->
            <div class="user-info">
                <div class="user-avatar" id="userAvatar">U</div>
                <div class="user-details">
                    <div class="username" id="displayUsername">Username</div>
                    <button class="logout-btn" onclick="logout()">Logout</button>
                </div>
            </div>

            <!-- Stats Grid -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="balanceValue">0.00</div>
                    <div class="stat-label">WorkRate</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="usdBalanceValue">$0.00</div>
                    <div class="stat-label">PTS</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="workRateValue">0</div>
                    <div class="stat-label">USD</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="levelValue">0</div>
                    <div class="stat-label">WorkRate</div>
                </div>
            </div>

            <!-- Level Progress -->
            <div class="level-section">
                <div class="level-header">
                    <div class="level-label">Performance WorkLevel</div>
                    <div class="level-value" id="levelPercent">0%</div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="levelProgress" style="width: 0%"></div>
                </div>
            </div>

            <!-- Bottom Navigation -->
            <div class="bottom-nav">
                <div class="nav-item active" data-target="work-section">Work</div>
                <div class="nav-item" data-target="cashout-section">Cashout</div>
                <div class="nav-item" data-target="terms-section">Terms</div>
            </div>

            <!-- Work Section -->
            <div class="content-section active" id="work-section">
                <!-- Work Submission Form -->
                <div class="work-form">
                    <div class="form-title">Submit Work</div>
                    <textarea class="work-input" id="workInput" placeholder="Enter your work submission here..."></textarea>
                    <button class="submit-btn" onclick="submitWork()">Submit Work</button>
                </div>

                <!-- Submission Status -->
                <div class="submission-status">
                    <div class="status-title">Submission Status</div>
                    <div class="status-badges" id="statusBadges">
                        <!-- Status badges will be added here dynamically -->
                    </div>
                </div>
            </div>

            <!-- Cashout Section -->
            <div class="content-section" id="cashout-section">
                <div class="cashout-form">
                    <div class="form-title">Request Cashout</div>
                    <select class="reward-select" id="rewardSelect" onchange="updateRewardDetails()">
                        <option value="">Select a reward</option>
                        <option value="amazon_1" data-workrate="1.39" data-amount="1.39">Amazon UK Voucher 1GBP</option>
                        <option value="amazon_2" data-workrate="2.80" data-amount="2.80">Amazon UK Voucher 2GBP</option>
                    </select>
                    
                    <div class="reward-details" id="rewardDetails">
                        <div class="reward-detail">
                            <span>USD Required:</span>
                            <span id="requiredWorkRate">0</span>
                        </div>
                        <div class="reward-detail">
                            <span>AmountUSD:</span>
                            <span id="rewardAmount">$0.00</span>
                        </div>
                        <div class="reward-detail">
                            <span>Your USD Balance:</span>
                            <span id="userWorkRate">0</span>
                        </div>
                        <div class="reward-detail">
                            <span>Your PTS:</span>
                            <span id="userBalance">0.00</span>
                        </div>
                    </div>
                    
                    <div class="eligibility-status" id="eligibilityStatus"></div>
                    
                    <button class="submit-btn" onclick="submitCashout()" id="cashoutBtn" disabled>Request Cashout</button>
                </div>

                <div class="cashout-history">
                    <div class="status-title">Cashout History</div>
                    <div id="cashoutHistory">
                        <!-- Cashout history will be added here dynamically -->
                    </div>
                </div>
            </div>

            <!-- Terms Section -->
            <div class="content-section" id="terms-section">
                <div class="form-title">Terms of Use</div>
                
                <div class="accordion">
                    <div class="accordion-item">
                        <div class="accordion-header" onclick="toggleAccordion(this)">
                            Work Submission Process
                            <span class="accordion-icon">▼</span>
                        </div>
                        <div class="accordion-content">
                            <p class="terms-text">
                                Users submit their work via the provided form. Our admin team reviews all submitted work for compliance with our guidelines.
                            </p>
                            <p class="terms-text">
                                <span class="highlight">Important:</span> If your work is not approved within 24 hours of submission, this indicates that your submission was incorrect or did not meet our requirements. In such cases, you will not see any approval notification.
                            </p>
                        </div>
                    </div>
                    
                    <div class="accordion-item">
                        <div class="accordion-header" onclick="toggleAccordion(this)">
                            Prohibited Activities
                            <span class="accordion-icon">▼</span>
                        </div>
                        <div class="accordion-content">
                            <p class="terms-text">
                                Spamming the submission form is strictly prohibited. This includes but is not limited to:
                            </p>
                            <ul class="terms-text" style="padding-left: 20px;">
                                <li>Submitting duplicate or near-identical work</li>
                                <li>Submitting low-quality or irrelevant content</li>
                                <li>Attempting to game the system through automated submissions</li>
                                <li>Any other activity we determine to be spam</li>
                            </ul>
                            <p class="terms-text">
                                <span class="highlight">Consequences:</span> If we detect spamming activities, your account will be <span class="highlight">permanently deleted</span> and you will <span class="highlight">forfeit your entire balance</span>.
                            </p>
                        </div>
                    </div>
                    
                    <div class="accordion-item">
                        <div class="accordion-header" onclick="toggleAccordion(this)">
                            Reward System
                            <span class="accordion-icon">▼</span>
                        </div>
                        <div class="accordion-content">
                            <p class="terms-text">
                                Upon approval of your submitted work, you will receive 50 points, which is approximately equivalent to $0.03 USD.
                            </p>
                            <p class="terms-text">
                                The conversion rate between points and USD may vary based on current valuation. We reserve the right to adjust the point-to-USD conversion rate at our discretion.
                            </p>
                        </div>
                    </div>
                    
                    <div class="accordion-item">
                        <div class="accordion-header" onclick="toggleAccordion(this)">
                            Cashout Policy
                            <span class="accordion-icon">▼</span>
                        </div>
                        <div class="accordion-content">
                            <p class="terms-text">
                                Cashout requests are processed manually by our admin team. Processing times may vary.
                            </p>
                            <p class="terms-text">
                                Each reward has specific Balance requirements that must be met before you can request that reward.
                            </p>
                            <p class="terms-text">
                                Cashout requests will initially show as "Unsent" until approved by an admin. Once approved, the status will change to "Approved" and any admin notes will be visible.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Success Modal -->
    <div class="modal" id="successModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Success</div>
                <button class="modal-close" onclick="closeModal('successModal')">×</button>
            </div>
            <div class="modal-body">
                <p id="successMessage">Your work has been submitted successfully!</p>
            </div>
            <div class="modal-buttons">
                <button class="modal-btn" onclick="closeModal('successModal')">OK</button>
            </div>
        </div>
    </div>

    <!-- Error Modal -->
    <div class="modal" id="errorModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Error</div>
                <button class="modal-close" onclick="closeModal('errorModal')">×</button>
            </div>
            <div class="modal-body">
                <p id="errorMessage">Invalid username or password.</p>
            </div>
            <div class="modal-buttons">
                <button class="modal-btn" onclick="closeModal('errorModal')">OK</button>
            </div>
        </div>
    </div>

    <!-- Cashout Processing Modal -->
    <div class="modal" id="cashoutModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Processing Cashout</div>
                <button class="modal-close" onclick="closeModal('cashoutModal')">×</button>
            </div>
            <div class="modal-body">
                <p id="cashoutMessage">Submitting your cashout request...</p>
            </div>
            <div class="modal-buttons">
                <button class="modal-btn" onclick="closeModal('cashoutModal')">Cancel</button>
            </div>
        </div>
    </div>

    <script>
    // Google Apps Script Web App URL
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwrJuI50NO7QyNr0Pc0HyGKQwHn0Bn8yuTAeIhu_pCf4AlIf_NbWmob4lCyGb8yPaeL/exec';

    // Current user data
    let currentUser = null;
    let userSubmissions = [];
    let userCashouts = [];

    // Session management
    const SESSION_KEY = 'workRewardSession';

    // Check for existing session on page load
    function checkExistingSession() {
        const savedSession = localStorage.getItem(SESSION_KEY);
        if (savedSession) {
            try {
                const sessionData = JSON.parse(savedSession);
                // Check if session is still valid (less than 24 hours old)
                const sessionAge = Date.now() - sessionData.timestamp;
                const twentyFourHours = 24 * 60 * 60 * 1000;
                
                if (sessionAge < twentyFourHours) {
                    // Session is valid, attempt to restore
                    attemptSessionRestore(sessionData.username);
                } else {
                    // Session expired, clear it
                    clearSession();
                }
            } catch (error) {
                console.error('Error parsing saved session:', error);
                clearSession();
            }
        }
    }

    // Attempt to restore user session
    async function attemptSessionRestore(username) {
        try {
            showLoading('Restoring your session...');
            
            const formData = new FormData();
            formData.append('action', 'getUserData');
            formData.append('username', username);
            
            const response = await fetch(SCRIPT_URL, {
                method: 'POST',
                body: formData
            });
            
            const result = await response.json();
            
            if (result.status === 'success') {
                currentUser = result.user;
                userSubmissions = result.submissions || [];
                userCashouts = result.cashouts || [];
                hideLoading();
                showDashboard();
            } else {
                // User data not found or error, clear session
                hideLoading();
                clearSession();
                showError('Session expired. Please login again.');
            }
        } catch (error) {
            console.error('Session restore error:', error);
            hideLoading();
            clearSession();
            showError('Network error during session restore.');
        }
    }

    // Save session to localStorage
    function saveSession(username) {
        const sessionData = {
            username: username,
            timestamp: Date.now()
        };
        localStorage.setItem(SESSION_KEY, JSON.stringify(sessionData));
    }

    // Clear session from localStorage
    function clearSession() {
        localStorage.removeItem(SESSION_KEY);
        currentUser = null;
        userSubmissions = [];
        userCashouts = [];
    }

    // Show loading indicator
    function showLoading(message = 'Loading...') {
        let loadingEl = document.getElementById('loadingIndicator');
        if (!loadingEl) {
            loadingEl = document.createElement('div');
            loadingEl.id = 'loadingIndicator';
            loadingEl.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.7);
                display: flex;
                justify-content: center;
                align-items: center;
                color: white;
                font-size: 18px;
                z-index: 10000;
                flex-direction: column;
            `;
            loadingEl.innerHTML = `
                <div style="margin-bottom: 20px;">${message}</div>
                <div class="spinner"></div>
            `;
            document.body.appendChild(loadingEl);
        }
        loadingEl.style.display = 'flex';
    }

    // Hide loading indicator
    function hideLoading() {
        const loadingEl = document.getElementById('loadingIndicator');
        if (loadingEl) {
            loadingEl.style.display = 'none';
        }
    }

    // Update clock
    function updateClock() {
        const now = new Date();
        const month = String(now.getMonth() + 1).padStart(2, '0');
        const day = String(now.getDate()).padStart(2, '0');
        const hours = String(now.getHours() % 12 || 12).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');
        const ampm = now.getHours() >= 12 ? 'PM' : 'AM';
        const clockEl = document.getElementById('clock');
        if (clockEl) {
            clockEl.textContent = `${month}/${day} ${hours}:${minutes} ${ampm}`;
        }
    }

    // Login function
    async function login() {
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;
        
        if (!username || !password) {
            showError('Please enter both username and password.');
            return;
        }
        
        try {
            showLoading('Signing in...');
            
            const formData = new FormData();
            formData.append('action', 'login');
            formData.append('username', username);
            formData.append('password', password);
            
            const response = await fetch(SCRIPT_URL, {
                method: 'POST',
                body: formData
            });
            
            const result = await response.json();
            
            if (result.status === 'success') {
                currentUser = result.user;
                userSubmissions = result.submissions || [];
                userCashouts = result.cashouts || [];
                
                // Save session
                saveSession(username);
                hideLoading();
                showDashboard();
            } else {
                hideLoading();
                showError(result.message || 'Invalid username or password.');
            }
        } catch (error) {
            console.error('Login error:', error);
            hideLoading();
            showError('Network error. Please try again.');
        }
    }

    // Logout function
    function logout() {
        clearSession();
        
        // Reset forms
        const usernameInput = document.getElementById('username');
        const passwordInput = document.getElementById('password');
        const workInput = document.getElementById('workInput');
        const rewardSelect = document.getElementById('rewardSelect');
        
        if (usernameInput) usernameInput.value = '';
        if (passwordInput) passwordInput.value = '';
        if (workInput) workInput.value = '';
        if (rewardSelect) rewardSelect.value = '';
        
        // Show login form
        const loginForm = document.getElementById('loginForm');
        const dashboard = document.getElementById('dashboard');
        
        if (loginForm) loginForm.style.display = 'block';
        if (dashboard) dashboard.style.display = 'none';
        
        // Hide any modals
        closeAllModals();
    }

    // Show dashboard
    function showDashboard() {
        const loginForm = document.getElementById('loginForm');
        const dashboard = document.getElementById('dashboard');
        
        if (loginForm) loginForm.style.display = 'none';
        if (dashboard) dashboard.style.display = 'block';
        
        if (!currentUser) {
            showError('No user data available.');
            return;
        }
        
        // Update user info
        const userAvatar = document.getElementById('userAvatar');
        const displayUsername = document.getElementById('displayUsername');
        
        if (userAvatar) userAvatar.textContent = currentUser.username.charAt(0).toUpperCase();
        if (displayUsername) displayUsername.textContent = currentUser.username;
        
        // Update stats
        const balanceValue = document.getElementById('balanceValue');
        const usdBalanceValue = document.getElementById('usdBalanceValue');
        const workRateValue = document.getElementById('workRateValue');
        const levelValue = document.getElementById('levelValue');
        
        if (balanceValue) balanceValue.textContent = currentUser.balance || 0;
        if (usdBalanceValue) usdBalanceValue.textContent = `$${parseFloat(currentUser.balanceUSD || 0).toFixed(2)}`;
        if (workRateValue) workRateValue.textContent = currentUser.workRate || 0;
        if (levelValue) levelValue.textContent = currentUser.level || 0;
        
        // Update level progress
        const levelPercent = parseInt(currentUser.level || 0);
        const levelPercentEl = document.getElementById('levelPercent');
        const progressFill = document.getElementById('levelProgress');
        
        if (levelPercentEl) levelPercentEl.textContent = `${levelPercent}%`;
        if (progressFill) {
            progressFill.style.width = `${Math.min(levelPercent, 100)}%`;
            // Set progress bar color based on level
            if (levelPercent < 50) {
                progressFill.className = 'progress-fill low';
            } else if (levelPercent < 80) {
                progressFill.className = 'progress-fill medium';
            } else {
                progressFill.className = 'progress-fill high';
            }
        }
        
        // Update submission status badges
        updateStatusBadges();
        
        // Update cashout history
        updateCashoutHistory();
        
        // Reset reward selection
        const rewardSelect = document.getElementById('rewardSelect');
        const rewardDetails = document.getElementById('rewardDetails');
        const eligibilityStatus = document.getElementById('eligibilityStatus');
        const cashoutBtn = document.getElementById('cashoutBtn');
        
        if (rewardSelect) rewardSelect.value = '';
        if (rewardDetails) rewardDetails.style.display = 'none';
        if (eligibilityStatus) eligibilityStatus.style.display = 'none';
        if (cashoutBtn) cashoutBtn.disabled = true;
    }

    // Submit work function
    async function submitWork() {
        if (!currentUser) {
            showError('Please login first.');
            return;
        }
        
        const workInput = document.getElementById('workInput');
        const workText = workInput ? workInput.value.trim() : '';
        
        if (!workText) {
            showError('Please enter your work submission.');
            return;
        }
        
        try {
            showLoading('Submitting your work...');
            
            const formData = new FormData();
            formData.append('action', 'submitWork');
            formData.append('username', currentUser.username);
            formData.append('submission', workText);
            
            const response = await fetch(SCRIPT_URL, {
                method: 'POST',
                body: formData
            });
            
            const result = await response.json();
            
            if (result.status === 'success') {
                // Refresh user data to get updated balances
                await refreshUserData();
                
                // Clear input
                if (workInput) workInput.value = '';
                hideLoading();
                
                // Show success message
                showSuccess('Your work has been submitted successfully!');
            } else {
                hideLoading();
                showError(result.message || 'Failed to submit work.');
            }
        } catch (error) {
            console.error('Submit work error:', error);
            hideLoading();
            showError('Network error. Please try again.');
        }
    }

    // Refresh user data from server
    async function refreshUserData() {
        if (!currentUser) return;
        
        try {
            const formData = new FormData();
            formData.append('action', 'getUserData');
            formData.append('username', currentUser.username);
            
            const response = await fetch(SCRIPT_URL, {
                method: 'POST',
                body: formData
            });
            
            const result = await response.json();
            
            if (result.status === 'success') {
                currentUser = result.user;
                userSubmissions = result.submissions || [];
                userCashouts = result.cashouts || [];
                showDashboard(); // Refresh the display
            }
        } catch (error) {
            console.error('Refresh user data error:', error);
        }
    }

    // Update status badges
    function updateStatusBadges() {
        const statusBadges = document.getElementById('statusBadges');
        if (!statusBadges) return;
        
        statusBadges.innerHTML = '';
        
        // Show only the 5 most recent submissions
        const recentSubmissions = userSubmissions.slice(0, 5);
        
        if (recentSubmissions.length === 0) {
            statusBadges.innerHTML = '<div style="color: white; font-style: italic; text-align: center; padding: 10px;">No submissions yet</div>';
            return;
        }
        
        recentSubmissions.forEach(submission => {
            const badge = document.createElement('div');
            badge.className = `status-badge ${submission.status === 'REVIEW' ? 'status-review' : 'status-approved'}`;
            
            const icon = document.createElement('span');
            icon.className = 'badge-icon';
            icon.textContent = submission.status === 'REVIEW' ? '⏳' : '✅';
            
            const text = document.createElement('span');
            text.textContent = submission.status === 'REVIEW' ? 'REVIEW' : 'APPROVED';
            
            badge.appendChild(icon);
            badge.appendChild(text);
            statusBadges.appendChild(badge);
        });
    }

    // Navigation between sections
    function setupNavigation() {
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', function() {
                // Remove active class from all nav items and content sections
                document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
                document.querySelectorAll('.content-section').forEach(section => section.classList.remove('active'));
                
                // Add active class to clicked nav item and corresponding section
                this.classList.add('active');
                const targetId = this.getAttribute('data-target');
                const targetSection = document.getElementById(targetId);
                if (targetSection) {
                    targetSection.classList.add('active');
                }
            });
        });
    }

    // Update reward details when selection changes
    function updateRewardDetails() {
        if (!currentUser) return;
        
        const select = document.getElementById('rewardSelect');
        const details = document.getElementById('rewardDetails');
        const cashoutBtn = document.getElementById('cashoutBtn');
        const eligibilityStatus = document.getElementById('eligibilityStatus');
        
        if (!select || !details || !cashoutBtn || !eligibilityStatus) return;
        
        if (select.value) {
            const selectedOption = select.options[select.selectedIndex];
            const workRateRequired = selectedOption.getAttribute('data-workrate');
            const amount = selectedOption.getAttribute('data-amount');
            
            const requiredWorkRate = document.getElementById('requiredWorkRate');
            const rewardAmount = document.getElementById('rewardAmount');
            const userWorkRate = document.getElementById('userWorkRate');
            const userBalance = document.getElementById('userBalance');
            
            if (requiredWorkRate) requiredWorkRate.textContent = workRateRequired;
            if (rewardAmount) rewardAmount.textContent = `$${amount}`;
            if (userWorkRate) userWorkRate.textContent = currentUser.workRate || 0;
            if (userBalance) userBalance.textContent = `$${parseFloat(currentUser.balanceUSD || 0).toFixed(2)}`;
            
            details.style.display = 'block';
            
            // Check eligibility
            const workRateEligible = parseInt(currentUser.workRate || 0) >= parseInt(workRateRequired);
            const balanceEligible = parseFloat(currentUser.balanceUSD || 0) >= parseFloat(amount);
            const isEligible = workRateEligible && balanceEligible;
            
            // Update eligibility status
            if (isEligible) {
                eligibilityStatus.textContent = "✓ You are eligible for this reward!";
                eligibilityStatus.className = "eligibility-status eligible";
                eligibilityStatus.style.display = "block";
            } else {
                let message = "You are not eligible for this reward. ";
                if (!workRateEligible && !balanceEligible) {
                    message += `You need ${workRateRequired} USD (you have ${currentUser.workRate || 0}) and $${amount} USD balance (you have $${parseFloat(currentUser.balanceUSD || 0).toFixed(2)}).`;
                } else if (!workRateEligible) {
                    message += `You need ${workRateRequired} Work Rate (you have ${currentUser.workRate || 0}).`;
                } else {
                    message += `You need $${amount} USD balance (you have $${parseFloat(currentUser.balanceUSD || 0).toFixed(2)}).`;
                }
                eligibilityStatus.textContent = message;
                eligibilityStatus.className = "eligibility-status not-eligible";
                eligibilityStatus.style.display = "block";
            }
            
            // Enable/disable cashout button based on requirements
            cashoutBtn.disabled = !isEligible;
        } else {
            details.style.display = 'none';
            eligibilityStatus.style.display = 'none';
            cashoutBtn.disabled = true;
        }
    }

    // Submit cashout request
    async function submitCashout() {
        if (!currentUser) {
            showError('Please login first.');
            return;
        }
        
        const select = document.getElementById('rewardSelect');
        if (!select || !select.value) {
            showError('Please select a reward first.');
            return;
        }
        
        const selectedOption = select.options[select.selectedIndex];
        const rewardName = selectedOption.text;
        const workRateRequired = selectedOption.getAttribute('data-workrate');
        const amount = selectedOption.getAttribute('data-amount');
        
        try {
            showLoading('Processing your cashout request...');
            
            const formData = new FormData();
            formData.append('action', 'submitCashout');
            formData.append('username', currentUser.username);
            formData.append('reward', rewardName);
            formData.append('workRateRequired', workRateRequired);
            formData.append('amount', amount);
            
            const response = await fetch(SCRIPT_URL, {
                method: 'POST',
                body: formData
            });
            
            const result = await response.json();
            
            if (result.status === 'success') {
                // Refresh user data to get updated balance
                await refreshUserData();
                
                // Reset form
                if (select) select.value = '';
                const rewardDetails = document.getElementById('rewardDetails');
                const eligibilityStatus = document.getElementById('eligibilityStatus');
                const cashoutBtn = document.getElementById('cashoutBtn');
                
                if (rewardDetails) rewardDetails.style.display = 'none';
                if (eligibilityStatus) eligibilityStatus.style.display = 'none';
                if (cashoutBtn) cashoutBtn.disabled = true;
                
                hideLoading();
                showSuccess('Your cashout request has been submitted successfully!');
            } else {
                hideLoading();
                showError(result.message || 'Failed to submit cashout request.');
            }
        } catch (error) {
            console.error('Submit cashout error:', error);
            hideLoading();
            showError('Network error. Please try again.');
        }
    }

    // Update cashout history display
    function updateCashoutHistory() {
        const cashoutHistory = document.getElementById('cashoutHistory');
        if (!cashoutHistory) return;
        
        cashoutHistory.innerHTML = '';
        
        if (userCashouts.length === 0) {
            cashoutHistory.innerHTML = '<div style="color: white; font-style: italic; text-align: center; padding: 20px;">No cashout requests yet</div>';
            return;
        }
        
        userCashouts.forEach(cashout => {
            const item = document.createElement('div');
            item.className = 'cashout-item';
            
            const header = document.createElement('div');
            header.className = 'cashout-header';
            
            const reward = document.createElement('div');
            reward.className = 'cashout-reward';
            reward.textContent = cashout.reward;
            
            const status = document.createElement('div');
            status.className = `cashout-status ${cashout.status === 'PENDING' || cashout.status === 'UNSENT' ? 'status-pending' : cashout.status === 'APPROVED' ? 'status-approved' : 'status-rejected'}`;
            status.textContent = cashout.status;
            
            header.appendChild(reward);
            header.appendChild(status);
            
            const details = document.createElement('div');
            details.className = 'cashout-details';
            
            const amount = document.createElement('div');
            amount.className = 'cashout-detail';
            amount.textContent = `Amount: $${cashout.amount}`;
            
            const workRate = document.createElement('div');
            workRate.className = 'cashout-detail';
            workRate.textContent = `Work Rate Required: ${cashout.workRateRequired}`;
            
            const date = document.createElement('div');
            date.className = 'cashout-detail';
            date.textContent = `Date: ${new Date(cashout.timestamp).toLocaleDateString()}`;
            
            details.appendChild(amount);
            details.appendChild(workRate);
            details.appendChild(date);
            
            item.appendChild(header);
            item.appendChild(details);
            
            // Add notes if available
            if (cashout.notes) {
                const notes = document.createElement('div');
                notes.className = 'cashout-notes';
                notes.textContent = `Admin Notes: ${cashout.notes}`;
                item.appendChild(notes);
            }
            
            cashoutHistory.appendChild(item);
        });
    }

    // Toggle accordion for terms section
    function toggleAccordion(header) {
        const item = header.parentElement;
        item.classList.toggle('active');
    }

    // Show success modal
    function showSuccess(message) {
        const successMessage = document.getElementById('successMessage');
        const successModal = document.getElementById('successModal');
        
        if (successMessage) successMessage.textContent = message;
        if (successModal) successModal.classList.add('active');
    }

    // Show error modal
    function showError(message) {
        const errorMessage = document.getElementById('errorMessage');
        const errorModal = document.getElementById('errorModal');
        
        if (errorMessage) errorMessage.textContent = message;
        if (errorModal) errorModal.classList.add('active');
    }

    // Close modal
    function closeModal(modalId) {
        const modal = document.getElementById(modalId);
        if (modal) {
            modal.classList.remove('active');
        }
    }

    // Close all modals
    function closeAllModals() {
        const modals = document.querySelectorAll('.modal');
        modals.forEach(modal => {
            modal.classList.remove('active');
        });
    }

    // Initialize the application
    function initApp() {
        // Set up navigation
        setupNavigation();
        
        // Set up modal close buttons
        document.querySelectorAll('.modal-close').forEach(closeBtn => {
            closeBtn.addEventListener('click', function() {
                const modal = this.closest('.modal');
                if (modal) {
                    modal.classList.remove('active');
                }
            });
        });
        
        // Set up enter key for login
        const usernameInput = document.getElementById('username');
        const passwordInput = document.getElementById('password');
        
        function handleEnterKey(e) {
            if (e.key === 'Enter') {
                login();
            }
        }
        
        if (usernameInput) {
            usernameInput.addEventListener('keypress', handleEnterKey);
        }
        if (passwordInput) {
            passwordInput.addEventListener('keypress', handleEnterKey);
        }
        
        // Start clock
        updateClock();
        setInterval(updateClock, 1000);
        
        // Check for existing session
        checkExistingSession();
    }

    // Initialize when DOM is loaded
    document.addEventListener('DOMContentLoaded', initApp);
    </script>

    <!-- Add CSS for loading spinner -->
    <style>
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 4px solid #ffffff;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</body>
</html>
